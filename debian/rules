#!/usr/bin/make -f

export DH_OPTIONS
export DH_VERBOSE

clean:
	scons clean

	rm -f site_scons/*.pyc
	rm -f site_scons/site_tools/*.pyc
	rm -rf site_scons/__pycache__
	rm -f cantera.conf
	rm -f config.log
	rm -f debian/substvars

	dh_clean

binary: build
	dh_prep
	dh_installdeb
	dh_installdocs
	dh_installchangelogs
	dh_installman platform/posix/man/*

	scons install

	mkdir -p debian/cantera-common/usr/bin
	sed 's|#\!/usr/bin/env python$$|#\!/usr/bin/env python3|' interfaces/cython/cantera/ctml_writer.py > debian/cantera-common/usr/bin/ctml_writer
	sed 's|#\!/usr/bin/env python$$|#\!/usr/bin/env python3|' interfaces/cython/cantera/ck2cti.py > debian/cantera-common/usr/bin/ck2cti
	sed 's|#\!/usr/bin/env python$$|#\!/usr/bin/env python3|' interfaces/cython/cantera/ck2yaml.py > debian/cantera-common/usr/bin/ck2yaml
	sed 's|#\!/usr/bin/env python$$|#\!/usr/bin/env python3|' interfaces/cython/cantera/ctml2yaml.py > debian/cantera-common/usr/bin/ctml2yaml
	sed 's|#\!/usr/bin/env python$$|#\!/usr/bin/env python3|' interfaces/cython/cantera/cti2yaml.py > debian/cantera-common/usr/bin/cti2yaml
	chmod a+x debian/cantera-common/usr/bin/*
	rm -f debian/cantera-python3/usr/bin/*

	mkdir -p debian/cantera-dev/usr/lib/${DEB_HOST_MULTIARCH}/pkgconfig
	mv debian/cantera-dev/usr/lib/pkgconfig/cantera.pc debian/cantera-dev/usr/lib/${DEB_HOST_MULTIARCH}/pkgconfig/

	dh_strip
	dh_shlibdeps
	dh_compress
	dh_gencontrol
	dh_fixperms
	dh_builddeb

binary-arch: binary

binary-indep: binary
	/bin/true

build:
	scons build -j6 prefix=/usr blas_lapack_libs=lapack,blas system_sundials=y f90_interface=y renamed_shared_libraries=n python_package=full layout=debian system_eigen=y extra_inc_dirs=/usr/include/eigen3 system_fmt=y

build-arch: build

build-indep: build
